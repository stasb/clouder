!!!
%html
  %head
    %title Clouder
    = stylesheet_link_tag    "application", :media => "all"
    = javascript_include_tag "application"
    = javascript_include_tag "audio.min.js", :type => "text/javascript"
    = csrf_meta_tags
    :javascript
      $(function() {
              // Setup the player to autoplay the next track
              var a = audiojs.createAll({
                trackEnded: function() {
                  var next = $('ol li.playing').next();
                  if (!next.length) next = $('ol li').first();
                  next.addClass('playing').siblings().removeClass('playing');
                  audio.load($('a', next).attr('data-src'));
                  audio.play();
                }

              });

              // show what is currently playing

              // whatever has current class of 'playing', get that link's content
              // and insert it into a predefined 'currently-playing' div

              // Load in the first track
              var audio = a[0];
                  first = $('ol a').attr('data-src');
              $('ol li').first().addClass('playing');
              var current = $('.playing a').text();
              $('.currently-playing').replaceWith('<div class="currently-playing">' + current + '</div>');
              audio.load(first);

              // Load in a track on click
              $('ol li').click(function(e) {
                e.preventDefault();
                $(this).addClass('playing').siblings().removeClass('playing');
                audio.load($('a', this).attr('data-src'));
                var current = $('.playing a').text();
                $('.currently-playing').replaceWith('<div class="currently-playing">' + current + '</div>');
                audio.play();
              });
              // Keyboard shortcuts
              $(document).keydown(function(e) {
                var unicode = e.charCode ? e.charCode : e.keyCode;
                   // right arrow
                if (unicode == 39) {
                  var next = $('li.playing').next();
                  if (!next.length) next = $('ol li').first();
                  next.click();
                  // back arrow
                } else if (unicode == 37) {
                  var prev = $('li.playing').prev();
                  if (!prev.length) prev = $('ol li').last();
                  prev.click();
                  // spacebar
                } else if (unicode == 32) {
                  audio.playPause();
                }
              })
            });
  %body
    .container
      = form_tag tracks_path, :method => 'get' do
        %p
        - if params[:search]
          = text_field_tag :search, nil, :value => params[:search], :class => "search-box"
        - else
          = text_field_tag :search, nil, :placeholder => "enter a genre e.g. dubstep, electro, indie", :class => "search-box"
        %p
          = submit_tag "Give me tunes", :name => nil, :class => "btn btn-success btn-large"
      = yield
