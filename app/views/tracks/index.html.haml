.top-bar.row
  .logo.span4
    %a{:href => root_path}
      %img{:src => '/assets/logo-small.png'}
  .search-area.span6
    = form_tag tracks_path, :method => 'get' do
      %p
      - if params[:search]
        = text_field_tag :search, nil, :value => params[:search], :class => "search-box"
      - else
        = text_field_tag :search, nil, :placeholder => "enter a genre e.g. dubstep, electro", :class => "search-box"
      %p
        = submit_tag "Search", :name => nil, :class => "btn btn-success search-button"
  .powered.span2
    %a{:href => "http://soundcloud.com", :target => "_blank"}
      %img{:src => "/assets/powered.png"}
.tracks
  %audio{:preload => ""}
  .playerbar-2.row
    .t-title.span10
      .i-track-title
      .i-count-container
        .i-play-count
      .i-time-container
        .i-time-ago
    .player-controls.span2
      %a{:href => "#", :class => "previous"}
        %img{:src => "/assets/previous.png"}
      %a{:href => "#", :class => "next"}
        %img{:src => "/assets/next.png"}
  .query
    %h2
      Search results for "#{@query}"
  .row
    - @tracks.each do |track|
      - if track.stream_url != nil
        .span3
          .a-box
            %a{"data-src" => "#{track.stream_url}?client_id=f837b00cd8d79383183d405b33a8a25d", :href => "#"}
              .image-content
                %p{:class => "title-thumb"}
                  = truncate(track.title, :length => 80)
                  - if track.playback_count != 0
                    %span
                      \-
                      = track.playback_count
                      plays
              - if track.artwork_url == nil
                %img{:src => "/assets/no-album.png"}
              - else
                %img{:src => "#{track.artwork_url.sub("large","t300x300")}"}
              %img{:src => "/assets/play.png", :class => "playimage"}
              %img{:src => "/assets/pause.png", :class => "pauseimage"}
              %img{:src => "/assets/playing.png", :class => "playingimage"}
          .meta-data{:style => "display:none;"}
            %p{:class => "track-title"}
              = truncate(track.title, :length => 60)
            %p{:class => "play-count"}
              = track.playback_count
            %p{:class => "url"}
              = track.permalink_url
            - if track.release_day != nil
              - raw_date = (track.release_day.to_s + "/" + track.release_month.to_s + "/" + track.release_year.to_s)
              - date = DateTime.strptime(raw_date, '%d/%m/%Y')
              - timeago = time_ago_in_words(date)
              %p{:class => "timeago"}
                = raw_date

.pagination
  %span.nav-container
    - if @current_page.to_i == 2
      %h3
        = link_to 'Previous', tracks_path(:search => @query)
        %span /
      %h3
        = link_to 'Next', tracks_path(:search => @query, :page => (@current_page.to_i + 1))
        %span /
      %h3
        = link_to 'First', tracks_path(:search => @query)
      %h3.page-count
        %span /
        = @current_page
        %span /
    - elsif @current_page.to_i > 2
      %h3
        = link_to 'Previous', tracks_path(:search => @query, :page => (@current_page.to_i - 1))
        %span /
      %h3
        = link_to 'Next', tracks_path(:search => @query, :page => (@current_page.to_i + 1))
        %span /
      %h3
        = link_to 'First', tracks_path(:search => @query)
      %h3.page-count
        %span /
        = @current_page
        %span /
    - else
      %h3
        = link_to 'Next Page', tracks_path(:search => @query, :page => 2)

.footer.row
  .footer-nav.span6
    %p
      Â© 2013 On A Cloud
  .footer-info.span6
    %p
      Developed by
      %a{:href => 'http://au.linkedin.com/in/stasbelkov', :target => '_blank'}
        Stas Belkov
